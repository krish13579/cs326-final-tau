<html>

<head>
    <meta charset="UTF-8">
    <title>Login Page</title>
    <link href="/public/assets/login.css" rel="stylesheet" type="text/css" />
    <script type="module" src="login.js" defer></script>

</head>

<body>

    <br><br><br><br><br><br>
    <div class="centered">
        <header>Ride Buddy.</header>
    </div>
    <br><br>
    <div class="centered">
        <input placeholder="Username" id="Username" />
    </div>
    <br><br>
    <div class="centered">
        <input placeholder="Password" id="Password" />
    </div>
    <br><br>
    <div class="centered">
        <button class="myButton" id="submit">Submit</button>
    </div>

    <br>
    <div class="centered">
        <p>Not already a user? <u id="signup">Sign Up</u></p>
    </div>
    <script>


        document.getElementById("submit").addEventListener("click", () => {
            let username = document.getElementById("Username").value;
            let pass = document.getElementById("Password").value;
            let userObj = {
                "email" : username, 
                "password": pass
            }
            if (username.length != 0 && pass.length != 0) {
                sendServer(userObj);
            }
            else {
                alert("Please enter a username and password.")
            }
        });
        document.getElementById("signup").addEventListener("click", () => {
            window.location.href = "/views/pages/Sign Up Page/signUp";
        });


        // async function verify() {
        //     let responseR = await fetch('/verifyUser');
        //     if (responseR.ok) {
        //         let response1 = await responseR.json();
        //         // let {userid} = response1.body;
        //         window.location.href = "/views/pages/Your Rides Page/yourRides";
        //     } else {
        //         console.log("verify: ", responseR);
        //         alert("UserID or password did not match our records. Please try again or sign up!!")
        //     }

        // }
        async function sendServer(nUser) {
            let response = await fetch('/verifyUser', {
                method: 'POST',
                json: true,
                body: JSON.stringify(nUser),
                headers: {
                    'Content-type': 'application/json; charset=UTF-8',
                }
            });

            if (response.ok) {
                let response2 = await response.json();
                if (window.localStorage.getItem("userName") !== null){
                    window.localStorage.removeItem("userName");
                }
                window.localStorage.setItem("userName", JSON.stringify(document.getElementById("Username").value));
                alert(JSON.parse(window.localStorage.getItem("userName")));
                window.location.href = "/views/pages/Your Rides Page/yourRides"

            } else {
                if (response.status === 401) {
                    alert("UserID or password did not match our records. Please try again or sign up!");
                }
                else{
                    console.log(response);
                    alert("login failed");
                }
            }

        }
    </script>
</body>

</html>